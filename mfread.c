#include	<String.h>#include	"mstdio.h"/* In the regular ULTRIX environment the numeric arguments are unsigned * values and the number of bytes to read are the product of those * arguments (ie. size and count). */#define BYTES_TO_READ(x,y) ((x) * (y))longmfread(	register 	char *ptr,	unsigned long	size,	unsigned long	count,	register M_FILE 	*iop){	register unsigned s;	int c;	s = BYTES_TO_READ(size,count);	if (s == 0) return(0);	while (s > 0) {		if (iop->_cnt < s) {			if (iop->_cnt > 0) {				memcpy( ptr, iop->_ptr, iop->_cnt);				ptr += iop->_cnt;				s -= iop->_cnt;			}			/*			 * filbuf clobbers _cnt & _ptr,			 * so don't waste time setting them.			 */			if ((c = _mfilbuf(iop)) == EOF)				break;/*  * _filbuf uses negative numbers if in system V append mode.  Must * convert back to positive integer to work correctly. *  */#ifdef SYSTEM_FIVE			if (iop->_cnt < 0){ iop->_cnt *= (-1);}#endif			*ptr++ = c;			s--;		}		if (iop->_cnt >= s) {			memcpy( ptr,iop->_ptr, s);			iop->_ptr += s;			iop->_cnt -= s;			return (count);		}	}	return (count - ((s + size - 1) / size));}