#include 	<types.h>#include	<quickdraw.h>#include 	<packages.h>#include 	<Files.h>#include 	<errors.h>#include	<Strings.h>#include "file.h"#include "mstdio.h"#include "aprintf.h"short _mopen(	char *name,		short vrefnum,	long mode){short 	fd;				/*Mac file descriptor*/OSErr	error;IOParam pb;int rw = mode & 3;						c2pstr(name);			pb.ioCompletion = 0;			pb.ioResult = 0;			pb.ioVRefNum = vrefnum;			pb.ioVersNum = 0;			pb.ioRefNum = 0;			pb.ioPermssn = (rw == O_RDONLY) ? fsRdPerm : ((rw == O_WRONLY) ? fsWrPerm: fsRdWrPerm);			pb.ioMisc = 0;			if((pb.ioPermssn & fsWrPerm) && (mode & O_CREAT))			{					if((error = Create((void *)name,vrefnum,'????','TEXT')) != noErr && error != dupFNErr)				{	p2cstr((void *)name);					ap_error("_mopen: Create failed",error);					return(-1);				}			}			pb.ioNamePtr = (void *)name;			if((error = PBOpen((ParmBlkPtr)&pb,false)) == noErr)			{						p2cstr((void *)name);					fd = pb.ioRefNum;					if((pb.ioPermssn & fsWrPerm) && (mode & O_TRUNC))					{						if((error = SetEOF(fd,0L)) != noErr)						{	aprintf("_mopen: %s \n error = %d",name,error);							return(-1);						}					}					return(fd);			}			p2cstr((void *)name);			aprintf("_mopen: %s \n error = %d",name,error);			return(-1);}long_mclose(	short fd){short 	vrefnum;OSErr	error;IOParam pb;	if((error = GetVRefNum(fd, &vrefnum)) != noErr)	{	ap_error("_mclose: GetVRefNum", error);		return(-1);	}		pb.ioCompletion = 0;	pb.ioResult = 0;	pb.ioRefNum = fd;	if((error = PBFlushFile((ParmBlkPtr)&pb,false)) != noErr)	{	ap_error("_mclose: PBFlushFile",error);		return(-1);	}	if((error = PBClose((ParmBlkPtr)&pb,false)) != noErr)	{	ap_error("_mclose: PBClose",error);		return(-1);	}	if((error = FlushVol(0L,vrefnum)) != noErr)	{	ap_error("_mclose: FlushVol",error);		return(-1);	}	return(0);}	