#include "mstdio.h"#include "mmalloc.h"longmsetvbuf(	register M_FILE	*iop,	char	*buf,	long	type,	long	size){	if(iop && iop->_base != NULL && iop->_flag & _MIOMYBUF)		mfree((char*)iop->_base);	iop->_flag &= ~(_MIOMYBUF | _MIONBF | _MIOLBF);	switch (type)  {	    /* Note that the flags are the same as the possible values for	     * type.	     */	    case _MIONBF:		iop->_base = NULL;		iop->_bufsiz = 0;		break;	    case _MIOLBF:	    case _MIOFBF:	    			/* Fully buffered files and line buffered files are handled		 * the same way.  Check the size, then allocate the buffer		 * if the user didn't specify one.  If we allocate the buffer		 * mark it as ours.		 */	    	if ((iop->_bufsiz = size) == 0)	/* illegal size */			return(-1);		if ((iop->_base = buf) == NULL) {			iop->_base = mmalloc(size);			if (iop->_base == NULL)				return(-1);			iop->_flag |= _MIOMYBUF ;		}		break;	    default:			/* illegal type */		return(-1);	}	/* Set up the rest of the buffer information in the M_FILE structure	 */	iop->_flag &= ~(_MIONBF|_MIOLBF|_MIOFBF);	iop->_flag |= type;	iop->_ptr = iop->_base;	iop->_cnt = 0;	return 0;}