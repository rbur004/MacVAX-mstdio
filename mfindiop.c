#include <errno.h>#include "mstdio.h"extern char	*calloc();/* Pointers to dynamically allocated array of pointers to M_FILE structures */extern M_FILE	**_miob_start;extern M_FILE	**_miob_end;M_FILE *_mfindiop(void){	register M_FILE	**iov;	/* If the vector of pointers to file structures is not allocated,	 * attempt to allocate it.	 */	if (_miob_start == NULL) {		register int	n_iobs = getdtablesize();		_miob_start = (M_FILE **)calloc(n_iobs,sizeof(M_FILE *));		if (_miob_start == NULL) {			/* 004 - set errno: no memory */			errno = ENOMEM; 			return(NULL);		}		_miob_end = _miob_start + n_iobs ;		/* Have the first pointers point to the statically		 * allocated file structures.		 */		iov = _miob_start ;	}	/* Search for a free pointer, either NULL pointer or pointer	 * to an unused M_FILE structure.	 */	iov = _miob_start ;	while (*iov != NULL && (*iov)->_flag & (_MIOREAD|_MIOWRT|_MIORW))		if (++iov >= _miob_end) {			/* 004 set errno: too many files opened */			errno = EMFILE;			return(NULL);		}	/* If the pointer is NULL attempt to allocate a M_FILE structure.	 */	if (*iov == NULL)		*iov = (M_FILE *)calloc(1,sizeof(M_FILE));	/* 004 if calloc returns Null, set errno to no memory 	 */	 if (*iov == NULL) {	 	errno = ENOMEM;		return (NULL);	}	return(*iov);}